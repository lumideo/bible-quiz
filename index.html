<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì´ˆë“±2ë¶€ ì„±ê²½í€´ì¦ˆ</title>
  <style>
    :root{
      --bg:#f7f8fb;--fg:#222;--sub:#666;--brand:#284BA0;--ok:#1a9d5c;--bad:#c0392b;--card:#fff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    .wrap{max-width:960px;margin:0 auto;padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    h1{font-size:clamp(20px,4vw,36px);margin:0;color:var(--brand)}
    .card{background:var(--card);border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:20px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    button{border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
    .primary{background:var(--brand);color:#fff}
    .ghost{background:#eef2ff;color:#1f3a8a}
    .muted{background:#eceff3;color:#334155}
    .ok{background:var(--ok);color:#fff}
    .bad{background:var(--bad);color:#fff}
    .hidden{display:none}
    .meta{color:var(--sub);font-size:14px}
    .q-title{font-size:20px;line-height:1.5;margin:0 0 12px}
    .choices{display:grid;gap:10px}
    .choice{background:#f4f7ff;border:2px solid transparent;border-radius:12px;padding:12px;cursor:pointer;text-align:left}
    .choice:hover{border-color:#c7d2fe}
    .choice.correct{border-color:var(--ok);background:#effaf4}
    .choice.wrong{border-color:var(--bad);background:#fdecea}
    .progress{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,var(--brand),#6aa7ff);width:0%}
    .footer{display:flex;gap:10px;justify-content:space-between;align-items:center;margin-top:16px}
    .hint{font-size:14px;color:#0f172a;background:#fff7ed;border-left:4px solid #f59e0b;padding:10px;border-radius:6px}
    .pill{display:inline-block;background:#eef2ff;color:#1f3a8a;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .center{display:flex;flex-direction:column;align-items:center;gap:16px}
    .score-big{font-size:48px;font-weight:900}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
    .small{font-size:12px;color:var(--sub)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ì´ˆë“±2ë¶€ ì„±ê²½í€´ì¦ˆ</h1>
      <div class="meta" id="appMeta"></div>
    </header>

    <!-- Main Menu -->
    <section id="menu" class="card">
      <div class="center">
        <p class="meta">ëª¨ë“œë¥¼ ì„ íƒí•´ ì‹œì‘í•˜ì„¸ìš”</p>
        <div class="row">
          <button class="primary" id="btnPractice">ì—°ìŠµë¬¸ì œ</button>
          <button class="ghost" id="btnExam">ì‹¤ì „ë¬¸ì œ</button>
        </div>
        <div style="width:100%;max-width:520px">
          <div class="card" style="background:#f8fafc">
            <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
              <div>
                <div class="meta">ì¶œì œ ë°©ì‹</div>
                <div><strong>ì „ì²´ 70ë¬¸ì œ ì¤‘ ë§¤íšŒ 25ë¬¸ì œ</strong>ê°€ ëœë¤ìœ¼ë¡œ ì¶œì œë©ë‹ˆë‹¤.</div>
              </div>
              <span class="pill">ëœë¤ 25</span>
            </div>
          </div>
        </div>
        <div class="card" style="background:#fff;max-width:640px">
          <div class="meta" style="margin-bottom:8px">ë¬¸ì œ ë°ì´í„° ì„¤ì •</div>
          <label class="small">GitHub RAW JSON URL</label>
          <input id="jsonUrl" style="width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:10px" placeholder="ì˜ˆ) https://raw.githubusercontent.com/USER/REPO/branch/questions.json" />
          <div class="small" style="margin-top:8px">URLì´ ë¹„ì–´ìˆìœ¼ë©´ ë‚´ì¥ëœ ìƒ˜í”Œ 5ë¬¸ì œë¡œ í…ŒìŠ¤íŠ¸ë©ë‹ˆë‹¤.</div>
        </div>
      </div>
    </section>

    <!-- Quiz Area -->
    <section id="quiz" class="card hidden">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div>
          <div class="pill" id="modePill">ëª¨ë“œ</div>
          <div class="meta" id="counter">ë¬¸ì œ 1/25</div>
        </div>
        <div style="min-width:200px;width:40%">
          <div class="progress"><div class="bar" id="bar"></div></div>
        </div>
      </div>

      <h2 class="q-title" id="qTitle"></h2>
      <div id="hintBox" class="hint hidden"></div>
      <div id="choices" class="choices"></div>
      <div id="subjectiveBox" class="hidden">
        <input id="answerInput" class="mono" style="width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:10px" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" />
        <div class="row" style="margin-top:10px">
          <button id="btnHint" class="muted">íŒíŠ¸ ë³´ê¸°</button>
          <button id="btnSubmit" class="primary">ì •ë‹µ ì œì¶œ</button>
        </div>
      </div>

      <div class="footer">
        <div class="meta" id="feedback"></div>
        <div class="row">
          <button id="btnPrev" class="muted">ì´ì „</button>
          <button id="btnNext" class="primary">ë‹¤ìŒ</button>
        </div>
      </div>
    </section>

    <!-- Result -->
    <section id="result" class="card hidden">
      <div class="center">
        <div class="score-big" id="finalScore">0 / 25</div>
        <div id="remark" class="meta"></div>
        <div class="row">
          <button id="btnRetry" class="ghost">ë‹¤ì‹œ í’€ê¸° (ìƒˆë¡œìš´ 25ë¬¸ì œ)</button>
          <button id="btnHome" class="muted">ë©”ì¸ìœ¼ë¡œ</button>
        </div>
      </div>
      <div style="margin-top:16px">
        <details>
          <summary>í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ ë³´ê¸°</summary>
          <ol id="reviewList"></ol>
        </details>
      </div>
    </section>

    <audio id="sfx-correct" preload="auto" src="dingdong.mp3"></audio>
    <audio id="sfx-wrong" preload="auto" src="ddang.mp3"></audio>
  </div>

<script>
/* =====================
  ë°ì´í„° ìŠ¤í‚¤ë§ˆ
  {
    id: Number,                    // ê³ ìœ ë²ˆí˜¸ (PDF ìˆœë²ˆ ê¶Œì¥)
    type: 'mc' | 'fill' | 'ox',    // ê°ê´€ì‹/ì£¼ê´€ì‹/ OX(ì„ íƒí˜•ìœ¼ë¡œ ì²˜ë¦¬)
    question: 'ë¬¸í•­ ë‚´ìš©',
    choices: ['ë³´ê¸°1','ë³´ê¸°2',...], // mc/ox ì „ìš©
    answer: 1 or ['ì •ë‹µ','ì •ë‹µ2'], // mcëŠ” ì •ë‹µ ì¸ë±ìŠ¤(0ê¸°ì¤€), fillì€ í—ˆìš© ë¬¸ìì—´ ë°°ì—´
    hint: 'íŒíŠ¸(ì„ íƒ)'
  }
===================== */

const appMeta = document.getElementById('appMeta');
appMeta.textContent = new Date().toLocaleDateString('ko-KR', { dateStyle: 'medium' });

// ìƒ˜í”Œ ë°ì´í„° (5ë¬¸ì œ) â€“ GitHub URLì´ ì—†ì„ ë•Œ ì‚¬ìš©
const SAMPLE = [
  {id:4,type:'fill',question:'íƒœì´ˆì— í•˜ë‚˜ë‹˜ì´ (     )ë¥¼ ì°½ì¡°í•˜ì‹œë‹ˆë¼. / ì°½ 1:1',answer:['ì²œì§€'],hint:'ë‘ ê¸€ì(ã„´ã…ˆ) â†’ í•˜ëŠ˜+ë•…ì˜ í•œìì–´'},
  {id:5,type:'mc',question:'í•˜ë‚˜ë‹˜ì€ ì„¸ìƒì„ ë©°ì¹  ë™ì•ˆ ë§Œë“œì…¨ë‚˜ìš”?',choices:['5ì¼','6ì¼','7ì¼','8ì¼'],answer:1},
  {id:16,type:'fill',question:'ë‹¤ì‹œëŠ” ë¬¼ë¡œ ì‹¬íŒí•˜ì§€ ì•Šê² ë‹¤ëŠ” ì•½ì†ì˜ ì¦ê±°ëŠ”?',answer:['ë¬´ì§€ê°œ'],hint:'í•˜ëŠ˜ì— ëœ¨ëŠ” ìƒ‰ìƒ‰ì˜ í™œ'},
  {id:26,type:'mc',question:'ì•„ë¸Œë¼í•¨ì´ 100ì„¸ì— ë‚³ì€ ì•½ì†ì˜ ì•„ë“¤ ì´ë¦„ì€?',choices:['ì´ìŠ¤ë§ˆì—˜','ì´ì‚­','ë¡¯','ë‹ˆë¯€ë¡¯'],answer:1},
  {id:37,type:'mc',question:'ë°”ë¡œì˜ ê¿ˆì„ í•´ì„í•œ ìš”ì…‰ì—ê²Œ ë§¡ê²¨ì§„ ì§ì±…ì€?',choices:['ë¹„ì„œì‹¤ì¥','êµ­ë°©ì¥ê´€','ì´ë¦¬','ì‹œìœ„ëŒ€ì¥'],answer:2}
];

// ìƒíƒœ
let ALL = [];           // ì „ì²´ 70ë¬¸ì œ
let PICKED = [];        // ë§¤íšŒ 25ë¬¸ì œ
let MODE = 'practice';  // 'practice' | 'exam'
let idx = 0;            // í˜„ì¬ ì¸ë±ìŠ¤ (0~24)
let score = 0;          // ì‹¤ì „ ì ìˆ˜
let answered = {};      // ì‚¬ìš©ìì˜ ë‹µì•ˆ ê¸°ë¡ {id: {correct:boolean, userAnswer:any}}

// ì—˜ë¦¬ë¨¼íŠ¸ ì°¸ì¡°
const menu = document.getElementById('menu');
const quiz = document.getElementById('quiz');
const result = document.getElementById('result');
const qTitle = document.getElementById('qTitle');
const hintBox = document.getElementById('hintBox');
const choicesBox = document.getElementById('choices');
const subjectiveBox = document.getElementById('subjectiveBox');
const answerInput = document.getElementById('answerInput');
const btnHint = document.getElementById('btnHint');
const btnSubmit = document.getElementById('btnSubmit');
const btnPrev = document.getElementById('btnPrev');
const btnNext = document.getElementById('btnNext');
const counter = document.getElementById('counter');
const bar = document.getElementById('bar');
const modePill = document.getElementById('modePill');
const feedback = document.getElementById('feedback');
const finalScore = document.getElementById('finalScore');
const remark = document.getElementById('remark');
const reviewList = document.getElementById('reviewList');
const jsonUrl = document.getElementById('jsonUrl');

const sfxCorrect = document.getElementById('sfx-correct');
const sfxWrong = document.getElementById('sfx-wrong');

// ìœ í‹¸
const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
const pickN = (arr,n) => shuffle(arr).slice(0, n);
const normalize = s => (s+"").trim().replace(/\s+/g,'').toLowerCase();

async function loadData(){
  const url = jsonUrl.value.trim();
  if(!url){ ALL = SAMPLE; return; }
  try{
    const res = await fetch(url);
    if(!res.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜');
    const data = await res.json();
    if(!Array.isArray(data)) throw new Error('JSON ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤');
    ALL = data;
  }catch(e){
    alert('ë¬¸ì œ JSON ë¡œë“œì— ì‹¤íŒ¨í•˜ì—¬ ìƒ˜í”Œ 5ë¬¸ì œë¡œ ì‹œì‘í•©ë‹ˆë‹¤.\nì˜¤ë¥˜: '+e.message);
    ALL = SAMPLE;
  }
}

function start(mode){
  MODE = mode;
  idx = 0; score = 0; answered = {};
  PICKED = pickN(ALL, Math.min(25, ALL.length));

  menu.classList.add('hidden');
  result.classList.add('hidden');
  quiz.classList.remove('hidden');

  modePill.textContent = mode==='practice' ? 'ì—°ìŠµëª¨ë“œ: ì •ë‹µì„ ë§ì¶°ì•¼ ë„˜ì–´ê°€ìš”' : 'ì‹¤ì „ëª¨ë“œ: ë°”ë¡œ ì±„ì  í›„ ë‹¤ìŒìœ¼ë¡œ';
  render();
}

function render(){
  const total = PICKED.length;
  counter.textContent = `ë¬¸ì œ ${idx+1}/${total}`;
  bar.style.width = `${((idx)/total)*100}%`;
  feedback.textContent = '';
  hintBox.classList.add('hidden');

  const q = PICKED[idx];
  qTitle.textContent = `${idx+1}. ${q.question}`; // ëª¨ë“  ë¬¸ì œ ë²ˆí˜¸ ë§¤ê¹€

  choicesBox.innerHTML = '';
  subjectiveBox.classList.add('hidden');

  if(q.type === 'mc' || q.type === 'ox'){
    choicesBox.classList.remove('hidden');
    const list = q.choices || [];
    list.forEach((choice,i)=>{
      const btn = document.createElement('button');
      btn.className = 'choice';
      btn.innerHTML = `<strong>${i+1}.</strong> ${choice}`; // ë³´ê¸°ì—ë„ ë²ˆí˜¸ í‘œì‹œ
      btn.onclick = ()=>handleChoice(i);
      choicesBox.appendChild(btn);
    });
  }else if(q.type === 'fill'){
    choicesBox.classList.add('hidden');
    subjectiveBox.classList.remove('hidden');
    answerInput.value = '';
    btnHint.onclick = ()=>{
      if(q.hint){ hintBox.textContent = 'íŒíŠ¸: '+q.hint; }
      else { hintBox.textContent = 'íŒíŠ¸ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì–´ìš”. (JSONì— "hint"ë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”)'; }
      hintBox.classList.remove('hidden');
    };
    btnSubmit.onclick = handleSubmit;
  }

  btnPrev.disabled = idx===0;
  btnNext.textContent = idx===total-1 ? 'ì œì¶œ' : 'ë‹¤ìŒ';
}

function ding(){ try{sfxCorrect.currentTime=0; sfxCorrect.play();}catch(_){} }
function dang(){ try{sfxWrong.currentTime=0; sfxWrong.play();}catch(_){} }

function handleChoice(i){
  const q = PICKED[idx];
  const nodes = [...document.querySelectorAll('.choice')];
  const correct = (i === q.answer);

  nodes.forEach((n,k)=>{
    n.disabled = true;
    if(k===q.answer) n.classList.add('correct');
  });

  if(correct){
    feedback.textContent = 'ë”©ë™ëŒ•! ì •ë‹µì´ì—ìš”';
    feedback.style.color = 'var(--ok)';
    ding();
  }else{
    feedback.textContent = 'ë•¡! í‹€ë ¸ì–´ìš”';
    feedback.style.color = 'var(--bad)';
    nodes[i].classList.add('wrong');
    dang();
  }

  answered[q.id] = {correct, userAnswer:i};

  if(MODE==='exam'){
    // ì •ë‹µì´ë“  ì•„ë‹ˆë“  ì ì‹œ í›„ ìë™ ë‹¤ìŒ
    setTimeout(next, 650);
    if(correct) score++;
  }else{
    // ì—°ìŠµ: ë§ì¶°ì•¼ ë‹¤ìŒìœ¼ë¡œ
    if(correct){
      setTimeout(next, 400);
    }
  }
}

function handleSubmit(){
  const q = PICKED[idx];
  const user = normalize(answerInput.value);
  const answers = (q.answer || []).map(normalize);
  const correct = answers.includes(user);

  if(correct){
    feedback.textContent = 'ë”©ë™ëŒ•! ì •ë‹µì´ì—ìš”';
    feedback.style.color = 'var(--ok)';
    ding();
  }else{
    feedback.textContent = 'ë•¡! ë‹¤ì‹œ ìƒê°í•´ ë³´ì';
    feedback.style.color = 'var(--bad)';
    dang();
  }

  answered[q.id] = {correct, userAnswer:answerInput.value};

  if(MODE==='exam'){
    if(correct) score++;
    setTimeout(next, 650);
  }else{
    // ì—°ìŠµ: ë§ì¶œ ë•Œê¹Œì§€ ëŒ€ê¸° (ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™”)
  }
}

function prev(){ if(idx>0){ idx--; render(); } }
function next(){
  const total = PICKED.length;
  if(idx < total-1){ idx++; render(); }
  else { finish(); }
}

function finish(){
  quiz.classList.add('hidden');
  result.classList.remove('hidden');
  bar.style.width = '100%';

  const total = PICKED.length;
  const calcScore = (MODE==='exam') ? score : Object.values(answered).filter(v=>v.correct).length;
  finalScore.textContent = `${calcScore} / ${total}`;
  remark.textContent = calcScore===total ? 'ì™„ë²½í•´ìš”! í›Œë¥­í•´ìš” ğŸ™Œ' : (calcScore>=Math.ceil(total*0.8) ? 'ì•„ì£¼ ì˜í–ˆì–´ìš”! ğŸ‘' : 'ì¢‹ì•„ìš”! í•œ ë²ˆ ë” ë„ì „í•´ë³¼ê¹Œìš”?');

  reviewList.innerHTML = '';
  PICKED.forEach((q, i)=>{
    const rec = answered[q.id];
    if(!rec || rec.correct) return;
    const li = document.createElement('li');
    let ansStr = '';
    if(q.type==='mc' || q.type==='ox') ansStr = `ì •ë‹µ: (${q.answer+1}) ${q.choices[q.answer]}`;
    else ansStr = `ì •ë‹µ: ${(q.answer||[]).join(' / ')}`;
    li.innerHTML = `<div><strong>${i+1}. ${q.question}</strong><div class="small">ë‚´ ë‹µ: ${rec?.userAnswer ?? '-'} Â· ${ansStr}</div></div>`;
    reviewList.appendChild(li);
  });
}

// ë„¤ë¹„ê²Œì´ì…˜ í•¸ë“¤ëŸ¬
btnPrev.onclick = prev;
btnNext.onclick = ()=>{
  if(idx === PICKED.length-1){ finish(); }
  else{
    // ì—°ìŠµëª¨ë“œì—ì„œ ì£¼ê´€ì‹/ê°ê´€ì‹ ëª¨ë‘ ì •ë‹µì„ ë§ì¶°ì•¼ ë„˜ì–´ê°€ë„ë¡ ì œì–´
    if(MODE==='practice'){
      const q = PICKED[idx];
      const rec = answered[q.id];
      if(!rec || !rec.correct){
        feedback.textContent = 'ì •ë‹µì„ ë§ì¶°ì•¼ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆì–´ìš”!';
        feedback.style.color = 'var(--bad)';
        dang();
        return;
      }
    }
    next();
  }
};

// ë©”ë‰´ ë²„íŠ¼
document.getElementById('btnPractice').onclick = async ()=>{ await loadData(); start('practice'); };
document.getElementById('btnExam').onclick = async ()=>{ await loadData(); start('exam'); };

document.getElementById('btnRetry').onclick = ()=>{ start(MODE); };
document.getElementById('btnHome').onclick = ()=>{
  quiz.classList.add('hidden');
  result.classList.add('hidden');
  menu.classList.remove('hidden');
};
</script>
</body>
</html>
