<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì´ˆë“±2ë¶€ ì„±ê²½í€´ì¦ˆ</title>
  <link rel="preload" href="questions_tuned_70.json" as="fetch" crossorigin="anonymous">
  <style>
    :root {
      --bg:#f7f7fb; --card:#fff; --txt:#222; --muted:#666; --brand:#4f46e5; --ok:#16a34a; --bad:#dc2626;
      --btn:#4f46e5; --btn-txt:#fff; --btn-sec:#eef2ff; --btn-sec-txt:#3730a3;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;background:var(--bg);color:var(--txt)}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    .hero{background:linear-gradient(180deg,#eef2ff,#fff);border-radius:16px;padding:24px 20px;margin-bottom:16px;border:1px solid #e5e7eb}
    h1{margin:0 0 8px;font-size:28px}
    .sub{margin:0;color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--btn);color:var(--btn-txt)}
    .btn-secondary{background:var(--btn-sec);color:var(--btn-sec-txt)}
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;padding:18px}
    .q-head{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px}
    .badge{font-size:12px;color:#555;background:#eef2ff;border-radius:999px;padding:6px 10px}
    .q-text{font-size:18px;line-height:1.5;margin:10px 0 12px}
    .choices{display:grid;gap:10px;margin-top:6px}
    .choice{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px;cursor:pointer}
    .choice input{margin-right:8px}
    .answer-box input{width:100%;font-size:16px;padding:12px;border-radius:10px;border:1px solid #d1d5db}
    .hint-bar{display:flex;align-items:center;gap:8px;margin-top:10px}
    .hint-box{display:none;background:#fffbeb;border:1px solid #fde68a;color:#92400e;border-radius:10px;padding:10px;margin-top:6px}
    .footer-bar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .status{color:var(--muted);font-size:14px;margin-top:6px}
    .score{font-weight:700}
    .hidden{display:none!important}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    .progress{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .progress > div{height:100%;background:var(--brand);width:0%}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>ì´ˆë“±2ë¶€ ì„±ê²½í€´ì¦ˆ</h1>
      <p class="sub">ì–˜ë“¤ì•„ ë¬¸ì œë¥¼ í’€ì–´ ë³¼ê¹Œìš”?</p>
      <div class="row">
        <button id="btnPractice" class="btn btn-primary">ì—°ìŠµë¬¸ì œ</button>
        <button id="btnExam" class="btn btn-secondary">ì‹¤ì „ë¬¸ì œ</button>
      </div>
    </div>

    <div id="screen" class="card hidden">
      <div class="q-head">
        <div>
          <span id="modeBadge" class="badge">ëª¨ë“œ</span>
        </div>
        <div style="min-width:180px;width:40%;max-width:320px">
          <div class="progress"><div id="prog"></div></div>
        </div>
      </div>

      <div id="qNum" class="status">ë¬¸ì œ 1 / 25</div>
      <div id="qText" class="q-text"></div>

      <div id="choices" class="choices"></div>

      <div id="fillWrap" class="answer-box hidden">
        <input id="fillInput" type="text" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
      </div>

      <div class="hint-bar">
        <button id="hintBtn" class="btn btn-secondary" style="display:none">íŒíŠ¸ ë³´ê¸°</button>
        <div id="hintBox" class="hint-box"><span id="hintText"></span></div>
      </div>

      <div class="footer-bar">
        <button id="submitBtn" class="btn btn-primary">ì œì¶œí•˜ê¸°</button>
        <button id="nextBtn" class="btn btn-secondary hidden">ë‹¤ìŒ ë¬¸ì œ</button>
      </div>

      <div id="status" class="status"></div>
    </div>

    <div id="result" class="card hidden">
      <h2>ê²°ê³¼</h2>
      <p class="q-text">ìˆ˜ê³ í–ˆìŠµë‹ˆë‹¤â™¥</p>
      <p class="status">ë§ì¶˜ ê°œìˆ˜: <span id="rightCount" class="score"></span> / <span id="totalCount"></span></p>
      <p class="status">ì ìˆ˜: <span id="percent" class="score"></span> ì </p>
      <div class="row">
        <button id="retryPractice" class="btn btn-secondary">ì—°ìŠµ ë‹¤ì‹œí•˜ê¸°</button>
        <button id="retryExam" class="btn btn-primary">ì‹¤ì „ ë‹¤ì‹œí•˜ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ì‚¬ìš´ë“œ -->
  <audio id="audio-correct" src="dingdong.mp3" preload="auto"></audio>
  <audio id="audio-wrong"   src="ddang.mp3"    preload="auto"></audio>

  <script>
  // ===== ì „ì—­ ìƒíƒœ =====
  const S = {
    all: [],
    pool: [],
    idx: 0,
    mode: 'practice', // 'practice' | 'exam'
    answered: false,
    correctCount: 0,
    total: 25,
  };

  const el = {
    btnPractice: document.getElementById('btnPractice'),
    btnExam: document.getElementById('btnExam'),
    screen: document.getElementById('screen'),
    result: document.getElementById('result'),
    modeBadge: document.getElementById('modeBadge'),
    qNum: document.getElementById('qNum'),
    qText: document.getElementById('qText'),
    choices: document.getElementById('choices'),
    fillWrap: document.getElementById('fillWrap'),
    fillInput: document.getElementById('fillInput'),
    hintBtn: document.getElementById('hintBtn'),
    hintBox: document.getElementById('hintBox'),
    hintText: document.getElementById('hintText'),
    submitBtn: document.getElementById('submitBtn'),
    nextBtn: document.getElementById('nextBtn'),
    status: document.getElementById('status'),
    prog: document.getElementById('prog'),
    resultRight: document.getElementById('rightCount'),
    resultTotal: document.getElementById('totalCount'),
    resultPercent: document.getElementById('percent'),
    retryPractice: document.getElementById('retryPractice'),
    retryExam: document.getElementById('retryExam'),
    audioCorrect: document.getElementById('audio-correct'),
    audioWrong: document.getElementById('audio-wrong'),
  };

  // ===== ì‚¬ìš´ë“œ (ë³¼ë¥¨/ì¬ìƒ) =====
  function playCorrect() {
    try {
      el.audioCorrect.volume = 0.95; // ë”©ë™ëŒ• ì¡°ê¸ˆ í¬ê²Œ
      el.audioCorrect.currentTime = 0;
      el.audioCorrect.play();
    } catch(e){}
  }
  function playWrong() {
    try {
      el.audioWrong.volume = 0.95;
      el.audioWrong.currentTime = 0;
      el.audioWrong.play();
    } catch(e){}
  }

  // ===== ìœ í‹¸ =====
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
  function sample25(arr){return shuffle(arr.slice()).slice(0,25)}
  function stripSpaces(s){return s.replace(/\s+/g,'')}
  function norm(s){return s.normalize('NFC').trim().toLowerCase()}

  // contains ê²€ì‚¬ (ìˆ«ìë¬¸ì œ ë³´ê°•íŒ)
function checkContains(userText, q){
  const raw = q.ignoreSpaces ? userText.replace(/\s+/g,'') : userText;
  const t = raw.normalize('NFC').trim().toLowerCase();

  const c = q.contains || {};
  const hasAll = Array.isArray(c.all) && c.all.length > 0;
  const keysAll = hasAll ? c.all : [];
  const keysAny = Array.isArray(c.any) ? c.any : [];

  // í‚¤ì›Œë“œ ì •ê·œí™”
  const normKey = (k) => {
    const s = String(k);
    const s2 = q.ignoreSpaces ? s.replace(/\s+/g,'') : s;
    return s2.normalize('NFC').trim().toLowerCase();
  };

  // âœ¨ ìˆ«ì ì „ìš© ë¹„êµ: í‚¤ì›Œë“œê°€ ëª¨ë‘ ìˆ«ìë©´ ìˆ«ìë¼ë¦¬ ë¹„êµ
  const allKeys = hasAll ? keysAll : keysAny;
  const keyNums = allKeys.map(k => normKey(k)).filter(v => /^\d+$/.test(v));
  const isNumericOnly = allKeys.length > 0 && keyNums.length === allKeys.length;

  if (isNumericOnly) {
    // ì…ë ¥ì—ì„œ ìˆ«ìë“¤ ì¶”ì¶œ
    const inputNums = (t.match(/\d+/g) || []).map(n => Number(n));
    if (inputNums.length === 0) return false;

    if (hasAll) {
      const need = keyNums.map(Number);
      return need.every(n => inputNums.includes(n));
    } else {
      const need = keyNums.map(Number);
      return inputNums.some(n => need.includes(n));
    }
  }

  // ğŸ”¤ ì¼ë°˜(ë¬¸ì) ë¹„êµ: í¬í•¨ ì—¬ë¶€
  if (hasAll){
    for (const k of keysAll){
      const key = normKey(k);
      if (!t.includes(key)) return false;
    }
    return true;
  }
  if (keysAny.length){
    for (const k of keysAny){
      const key = normKey(k);
      if (t.includes(key)) return true;
    }
    return false;
  }

  // contains ì—†ìœ¼ë©´ answers ì •í™•ë§¤ì¹­ìœ¼ë¡œ í´ë°±
  if (Array.isArray(q.answers)){
    const t2 = t;
    for (const ans of q.answers){
      const key = normKey(ans);
      if (t2 === key) return true;
    }
  }
  return false;
}

  // ì •ë‹µ íŒì •
  function isCorrect(q){
    if (q.type === 'mc'){
      const picked = document.querySelector('input[name="choice"]:checked');
      if (!picked) return null; // ë¬´ì‘ë‹µ
      const idx = Number(picked.value);
      return idx === q.answerIndex;
    } else {
      const val = el.fillInput.value || '';
      if (!val.trim()) return null; // ë¬´ì‘ë‹µ
      if (q.mode === 'contains') return checkContains(val, q);
      // fallback: answers ë°°ì—´ ì •í™•ë§¤ì¹­
      if (Array.isArray(q.answers)){
        const t = norm(q.ignoreSpaces ? stripSpaces(val) : val);
        return q.answers.some(a=>{
          const key = norm(q.ignoreSpaces ? stripSpaces(String(a)) : String(a));
          return t === key;
        });
      }
      return false;
    }
  }

  // ===== ë¶€ë“œëŸ¬ìš´ ìë™ íŒíŠ¸ ìƒì„±ê¸° (Bë²„ì „) =====
  function buildHintText(q, isPractice) {
    // 1) JSON hintê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš© (ë‹¨, "íŒíŠ¸ ì—†ìŒ"ì€ ë¬´ì‹œ)
    if (q.hint && q.hint.trim() && q.hint !== "íŒíŠ¸ ì—†ìŒ") return q.hint;

    // 2) ì—°ìŠµëª¨ë“œ + ì£¼ê´€ì‹ containsë©´ ìë™ íŒíŠ¸
    if (isPractice && q.type === "fill" && q.mode === "contains") {
      const keys = (q.contains?.all && q.contains.all.length)
        ? q.contains.all
        : (q.contains?.any || []);
      if (keys.length) return "íŒíŠ¸: " + keys.join(", ");
    }

    // 3) ê·¸ ì™¸ì—” íŒíŠ¸ ì—†ìŒ
    return "íŒíŠ¸ ì—†ìŒ";
  }

  // ===== ë¬¸ì œ ë Œë” =====
  function render(){
    const q = S.pool[S.idx];
    const isPractice = S.mode === 'practice';

    el.modeBadge.textContent = (S.mode === 'practice') ? 'ì—°ìŠµëª¨ë“œ' : 'ì‹¤ì „ëª¨ë“œ';
    el.qNum.textContent = `ë¬¸ì œ ${S.idx+1} / ${S.total}`;
    el.qText.textContent = q.q;

    // í”„ë¡œê·¸ë ˆìŠ¤
    el.prog.style.width = `${Math.round((S.idx)/S.total*100)}%`;

    // ì´ˆê¸°í™”
    el.choices.innerHTML = '';
    el.fillWrap.classList.add('hidden');
    el.hintBox.style.display = 'none';
    el.hintText.textContent = '';
    el.hintBtn.style.display = 'none';
    el.fillInput.value = '';
    el.status.textContent = '';
    el.nextBtn.classList.add('hidden');
    el.submitBtn.disabled = false;

    if (q.type === 'mc'){
      // ë³´ê¸° ë§Œë“¤ê¸°
      q.choices.forEach((c,i)=>{
        const id = `ch_${i}`;
        const label = document.createElement('label');
        label.className = 'choice';
        label.innerHTML = `<input type="radio" name="choice" value="${i}" id="${id}"> ${c}`;
        el.choices.appendChild(label);
      });
    } else {
      // ì£¼ê´€ì‹
      el.fillWrap.classList.remove('hidden');
    }

    // íŒíŠ¸ ë²„íŠ¼ ë…¸ì¶œ ê·œì¹™
    const built = buildHintText(q, isPractice);
    const hasHint = built && built !== "íŒíŠ¸ ì—†ìŒ";
    // ë²„íŠ¼ì€: (JSON íŒíŠ¸ê°€ ìˆê±°ë‚˜) ë˜ëŠ” (ì—°ìŠµëª¨ë“œ+ì£¼ê´€ì‹ contains)ë©´ í‘œì‹œ
    if (hasHint || (isPractice && q.type==='fill' && q.mode==='contains')) {
      el.hintBtn.style.display = 'inline-flex';
    } else {
      el.hintBtn.style.display = 'none';
    }

    // íŒíŠ¸ í´ë¦­
    el.hintBtn.onclick = () => {
      const txt = buildHintText(q, isPractice);
      const show = txt && txt !== "íŒíŠ¸ ì—†ìŒ";
      el.hintText.textContent = show ? txt : '';
      el.hintBox.style.display = show ? 'block' : 'none';
    };

    // ì œì¶œ
    el.submitBtn.onclick = () => {
      const res = isCorrect(q);
      if (res === null){
        // ë¬´ì‘ë‹µ ë°©ì§€(ì‹¤ì „/ì—°ìŠµ ë™ì¼í•˜ê²Œ ì•ˆë‚´)
        el.status.innerHTML = '<span class="bad">ë¨¼ì € ë‹µì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ ì£¼ì„¸ìš”.</span>';
        return;
      }
      if (res){
        playCorrect();
        el.status.innerHTML = '<span class="ok">ë”©ë™ëŒ•! ì •ë‹µì…ë‹ˆë‹¤.</span>';
        S.correctCount++;
        if (isPractice){
          // ì—°ìŠµ: ë§ì¶”ë©´ ìë™ ë‹¤ìŒ
          goNextAuto();
        } else {
          // ì‹¤ì „: ì±„ì  í›„ ìë™ ë‹¤ìŒ
          goNextAuto();
        }
      } else {
        playWrong();
        el.status.innerHTML = '<span class="bad">ë•¡! ë‹¤ì‹œ ë„ì „í•´ ë³´ì.</span>';
        if (isPractice){
          // ì—°ìŠµ: í‹€ë¦¬ë©´ ë¨¸ë¬¼ê¸°
        } else {
          // ì‹¤ì „: ìë™ ë‹¤ìŒ
          goNextAuto();
        }
      }
    };

    // ë‹¤ìŒ ë²„íŠ¼(ì—°ìŠµì—ì„œë§Œ ìˆ˜ë™ìœ¼ë¡œ ì“°ì¼ ìˆ˜ ìˆìŒ)
    el.nextBtn.onclick = () => goNext();
  }

  function goNextAuto(){
    // 900ms í›„ ë‹¤ìŒ ë¬¸ì œ
    el.submitBtn.disabled = true;
    setTimeout(goNext, 900);
  }

  function goNext(){
    S.idx++;
    el.prog.style.width = `${Math.round((S.idx)/S.total*100)}%`;
    if (S.idx >= S.total){
      finish();
      return;
    }
    render();
  }

  function finish(){
    el.screen.classList.add('hidden');
    el.result.classList.remove('hidden');
    el.resultTotal.textContent = S.total;
    el.resultRight.textContent = S.correctCount;
    const percent = Math.round((S.correctCount / S.total) * 100);
    el.resultPercent.textContent = percent;
  }

  // ===== ì‹œì‘/ì¬ë„ì „ =====
  function start(mode){
    S.mode = mode;
    S.idx = 0;
    S.correctCount = 0;
    S.pool = sample25(S.all);
    el.screen.classList.remove('hidden');
    el.result.classList.add('hidden');
    render();
  }

  el.btnPractice.addEventListener('click', ()=>start('practice'));
  el.btnExam.addEventListener('click', ()=>start('exam'));
  el.retryPractice.addEventListener('click', ()=>start('practice'));
  el.retryExam.addEventListener('click', ()=>start('exam'));

  // ===== ë°ì´í„° ë¡œë“œ =====
  async function init(){
    try{
      const res = await fetch('questions_tuned_70.json?v=' + Date.now());
      const data = await res.json();
      // ë°©ì–´: ë°°ì—´ ë³‘í•© í˜•íƒœ ë“¤ì–´ì˜¬ ìˆ˜ë„ ìˆì–´ í•œ ë²ˆ í‰íƒ„í™”
      S.all = Array.isArray(data) ? data.flat() : [];
    } catch(e){
      alert('ë¬¸ì œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
      console.error(e);
      return;
    }
  }

  init();
  </script>
</body>
</html>

